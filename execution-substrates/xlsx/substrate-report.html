<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xlsx - Substrate Report</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-code: #1e1e1e;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-code: #d4d4d4;
            --border-color: #dee2e6;
            --accent-color: #0d6efd;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --radius: 6px;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-code: #0d1117;
            --text-primary: #eaeaea;
            --text-secondary: #b0b0b0;
            --text-code: #c9d1d9;
            --border-color: #3a3a5c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 1rem;
        }

        header {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        header .meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tab {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--bg-primary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .tab:hover {
            border-color: var(--accent-color);
        }

        .tab.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tab-content {
            display: none;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 1.5rem;
        }

        .section h2 {
            font-size: 1.2rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.25rem;
        }

        pre {
            background: var(--bg-code);
            color: var(--text-code);
            padding: 1rem;
            border-radius: var(--radius);
            overflow-x: auto;
            font-family: 'SF Mono', Monaco, Consolas, monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        footer {
            text-align: center;
            margin-top: 2rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        #theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>xlsx</h1>
            <div class="meta">Execution Substrate Report</div>
        </div>
        <div>
            <span class="meta">Generated: 2026-02-24 03:22:17</span>
            <button id="theme-toggle" onclick="toggleTheme()">&#127769;</button>
        </div>
    </header>

    <div class="tabs">
        <button class="tab active" onclick="showTab('overview')">Overview</button>
        <button class="tab" onclick="showTab('results')">Test Results</button>
        <button class="tab" onclick="showTab('log')">Execution Log</button>
    </div>

    <div id="overview" class="tab-content active">
        <div class="section">
            <h2>How This Substrate Works</h2>
            <pre># XLSX Execution Substrate

Excel workbook generated from the Effortless Rulebook.

## Overview

This substrate generates a fully functional Excel workbook where calculated fields are implemented as native Excel formulas. The workbook can be opened in Excel, LibreOffice Calc, or any compatible spreadsheet application.

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   inject-into-xlsx.py                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   1. Load rulebook JSON (structured data)                    â”‚
â”‚                          â†“                                   â”‚
â”‚   2. Create worksheets for each table                        â”‚
â”‚                          â†“                                   â”‚
â”‚   3. Convert {{FieldRef}} to Excel cell references           â”‚
â”‚                          â†“                                   â”‚
â”‚   4. Write formulas for calculated fields                    â”‚
â”‚                          â†“                                   â”‚
â”‚   5. Apply styling (headers, borders, calculated highlights) â”‚
â”‚                          â†“                                   â”‚
â”‚   6. Output: rulebook.xlsx                                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Features

- **Native Excel Formulas**: Calculated fields use real Excel formulas (IF, AND, NOT, etc.)
- **Multi-Worksheet**: One worksheet per table in the rulebook
- **Computed Values**: Formulas evaluate automatically in any spreadsheet app
- **Smart Update**: Only regenerates if content actually changed (avoids volatile function timestamp changes)
- **Professional Styling**: Header highlighting, calculated field backgrounds, frozen header rows

## Generated Files

| File | Description |
|------|-------------|
| `rulebook.xlsx` | **GENERATED** - Excel workbook with all tables and native formulas |
| `test-answers.json` | **GENERATED** - Test execution results for grading |
| `test-results.md` | **GENERATED** - Human-readable test report |

## Source Files (Not Cleaned)

| File | Description |
|------|-------------|
| `inject-into-xlsx.py` | The generator: converts rulebook to Excel workbook |
| `inject-substrate.sh` | Shell wrapper for orchestration |
| `take-test.py` | Test runner that reads computed values from xlsx |
| `take-test.sh` | Shell wrapper for test runner |
| `template.xml` | Template for Excel structure |
| `README.md` | This documentation |

## Cleaning

To remove all generated files:

```bash
python3 inject-into-xlsx.py --clean
```

This will remove:
- `rulebook.xlsx`
- `test-answers.json`
- `test-results.md`

## Technology

**Excel/XLSX** is a spreadsheet format developed by Microsoft. The `.xlsx` format (Office Open XML) is an open standard that stores worksheets, formulas, and formatting in a ZIP archive of XML files.

Key characteristics:
- **Native formulas**: Calculations are performed by the spreadsheet engine
- **Cell references**: Formulas use relative/absolute cell addressing
- **Cross-platform**: Works in Excel, LibreOffice, Google Sheets, etc.
- **Rich formatting**: Supports styles, colors, borders, and conditional formatting

This substrate uses `openpyxl` to generate XLSX files programmatically.

## Source

Generated from: `effortless-rulebook/effortless-rulebook.json`
</pre>
        </div>
    </div>

    <div id="results" class="tab-content">
        <div class="section">
            <h2>Test Results Summary</h2>
            <pre># Test Results: xlsx

## Summary

| Metric | Value |
|--------|-------|
| Total Fields Tested | 184 |
| Passed | 184 |
| Failed | 0 |
| Score | 100.0% |
| Duration | &lt; 1s |

## Results by Entity

### language_candidates

- Fields: 184/184 (100.0%)
- Computed columns: has_grammar, question, predicted_answer, prediction_predicates, prediction_fail, is_description_of, is_open_closed_world_conflicted, relationship_to_concept
</pre>
        </div>
    </div>

    <div id="log" class="tab-content">
        <div class="section">
            <h2>Execution Log</h2>
            <pre>=== XLSX (Excel) Substrate Test Run ===
Started: Tue Feb 24 03:22:16 CST 2026


  Processing language_candidates...
Found 26 fields in test answers
Primary key field: language_candidate_id
Reading from worksheet: LanguageCandidates
Found 26 columns, matched 26 to JSON fields
Loaded 23 rows from xlsx
Filled 164 null fields across 23 records
Updated /Users/eejai42/effortlessapi-app-root/users/user_ee42ai73-18a9-47d5-8f99-954b00f6c041/my-projects/ERB_effortless-rulebook-starter/execution-substrates/xlsx/test-answers/language_candidates.json

xlsx: Processed 1 entities from rulebook.xlsx

Completed: Tue Feb 24 03:22:16 CST 2026
</pre>
        </div>
    </div>

    <footer>
        Generated by ERB Substrate Report Generator
    </footer>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? '' : 'dark');
            document.getElementById('theme-toggle').textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        }
    </script>
</body>
</html>