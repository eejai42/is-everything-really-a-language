<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Substrate Report: golang</title>
    <style>
:root {
    --bg-primary: #ffffff; --bg-secondary: #f8f9fa; --bg-tertiary: #e9ecef;
    --text-primary: #212529; --text-secondary: #6c757d; --border-color: #dee2e6;
    --accent-color: #0d6efd; --success-color: #198754; --warning-color: #ffc107;
    --danger-color: #dc3545; --code-bg: #f6f8fa; --shadow: 0 2px 8px rgba(0,0,0,0.1); --radius: 6px;
}
[data-theme="dark"] {
    --bg-primary: #1a1a2e; --bg-secondary: #16213e; --bg-tertiary: #0f3460;
    --text-primary: #eaeaea; --text-secondary: #b0b0b0; --border-color: #3a3a5c;
    --accent-color: #4dabf7; --success-color: #51cf66; --warning-color: #fcc419;
    --danger-color: #ff6b6b; --code-bg: #0d1117; --shadow: 0 2px 8px rgba(0,0,0,0.3);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-secondary); color: var(--text-primary); line-height: 1.5; min-height: 100vh; }
header { background: var(--bg-primary); border-bottom: 1px solid var(--border-color); padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: center; }
.header-left { display: flex; align-items: center; gap: 0.75rem; }
.substrate-icon { font-size: 1.5rem; }
h1 { font-size: 1.1rem; font-weight: 600; }
.header-stats { display: flex; gap: 1rem; font-size: 0.8rem; }
.stat { display: flex; align-items: center; gap: 0.25rem; }
.stat-value { font-weight: 600; }
.score-perfect, .score-good { color: var(--success-color); }
.score-warning { color: var(--warning-color); }
.score-danger { color: var(--danger-color); }
#theme-toggle { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 50%; width: 28px; height: 28px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
#theme-toggle:hover { background: var(--accent-color); color: white; }
#theme-toggle .moon { display: none; }
[data-theme="dark"] #theme-toggle .sun { display: none; }
[data-theme="dark"] #theme-toggle .moon { display: inline; }
.tabs { display: flex; background: var(--bg-primary); border-bottom: 1px solid var(--border-color); overflow-x: auto; padding: 0 0.5rem; }
.tab { background: none; border: none; padding: 0.5rem 1rem; cursor: pointer; font-size: 0.8rem; color: var(--text-secondary); border-bottom: 2px solid transparent; white-space: nowrap; }
.tab:hover { color: var(--text-primary); }
.tab.active { color: var(--accent-color); border-bottom-color: var(--accent-color); font-weight: 500; }
main { padding: 1rem; }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.2s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.card { background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: var(--radius); padding: 1rem; margin-bottom: 1rem; box-shadow: var(--shadow); }
.card h2 { font-size: 0.9rem; font-weight: 600; margin-bottom: 0.75rem; }
pre { background: var(--code-bg); border: 1px solid var(--border-color); border-radius: var(--radius); padding: 0.75rem; overflow-x: auto; font-family: 'SF Mono', Monaco, monospace; font-size: 0.75rem; line-height: 1.4; max-height: 500px; overflow-y: auto; }
.code-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
.code-info { font-size: 0.75rem; color: var(--text-secondary); }
.copy-btn { background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; padding: 0.25rem 0.5rem; font-size: 0.7rem; cursor: pointer; }
.copy-btn:hover { background: var(--accent-color); color: white; }
.markdown-content { line-height: 1.6; }
.markdown-content p { margin-bottom: 0.75rem; }
.markdown-content ul, .markdown-content ol { margin-left: 1.5rem; margin-bottom: 0.75rem; }
.markdown-content li { margin-bottom: 0.25rem; }
.markdown-content code { background: var(--code-bg); padding: 0.125rem 0.375rem; border-radius: 3px; font-size: 0.85em; }
.results-summary { display: flex; gap: 1.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
.result-item { text-align: center; }
.result-value { font-size: 1.5rem; font-weight: 700; }
.result-label { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <span class="substrate-icon">ğŸ¹</span>
            <h1>Golang Execution Substrate</h1>
        </div>
        <div class="header-stats">
            <div class="stat"><span>Score:</span><span class="stat-value score-perfect">100.0%</span></div>
            <div class="stat"><span>3/3 passed</span></div>
        </div>
        <button id="theme-toggle" title="Toggle theme"><span class="sun">â˜€ï¸</span><span class="moon">ğŸŒ™</span></button>
    </header>
    <nav class="tabs">
        <button class="tab active" data-tab="description">Description</button>
        <button class="tab" data-tab="log">Run Log</button>
        <button class="tab" data-tab="results">Test Results</button>
        <button class="tab" data-tab="sdk">Generated SDK</button>
        <button class="tab" data-tab="main">Test Runner</button>
    </nav>
    <main>
        <div id="description" class="tab-content active">
            <div class="card">
                <h2>What This Substrate Does</h2>
                <div class="markdown-content">
                    <p>The Golang substrate compiles rulebook formulas into native Go code with Calc* methods, enabling high-performance formula evaluation with static typing.</p>
                    <h3>Orchestration Pattern</h3>
                    <ol>
                        <li><strong>Generate</strong>: <code>inject-into-golang.py</code> generates Go structs and Calc* methods</li>
                        <li><strong>Compile</strong>: Go compiler builds the test binary</li>
                        <li><strong>Execute</strong>: <code>erb_test</code> binary runs and produces test answers</li>
                        <li><strong>Test</strong>: Compare computed values against expected answers</li>
                    </ol>
                </div>
            </div>
            <div class="card">
                <h2>Key Features</h2>
                <ul class="markdown-content">
                    <li><strong>Static Typing</strong>: All fields are strongly typed Go structs</li>
                    <li><strong>Calc* Methods</strong>: Each calculated field has a dedicated method</li>
                    <li><strong>Pointer Semantics</strong>: Nullable fields use *bool, *string, etc.</li>
                    <li><strong>High Performance</strong>: Compiled native binary for fast execution</li>
                </ul>
            </div>
        </div>
        <div id="log" class="tab-content">
            <div class="card">
                <h2>Execution Log</h2>
                <pre>=== Go Substrate Test Run ===

golang: Starting test...
golang: Compiling and running...
Golang substrate: Processing 1 tables with calculated fields...
  Expected tables: Customers

Processing Customers...
  âœ“ customers: 3 records processed

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Golang substrate: ALL 1 tables processed successfully (3 total records)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

</pre>
            </div>
        </div>
        <div id="results" class="tab-content">
            <div class="card">
                <h2>Test Summary</h2>
                <div class="results-summary">
                    <div class="result-item"><div class="result-value score-perfect">100.0%</div><div class="result-label">Score</div></div>
                    <div class="result-item"><div class="result-value score-perfect">3</div><div class="result-label">Passed</div></div>
                    <div class="result-item"><div class="result-value">0</div><div class="result-label">Failed</div></div>
                    <div class="result-item"><div class="result-value">3</div><div class="result-label">Total</div></div>
                </div>
            </div>
        </div>
        <div id="sdk" class="tab-content">
            <div class="card">
                <div class="code-header">
                    <h2>erb_sdk.go</h2>
                    <div><span class="code-info">132 lines</span><button class="copy-btn" onclick="copyCode('sdk-code')">Copy</button></div>
                </div>
                <pre id="sdk-code">// ERB SDK - Go Implementation (GENERATED - DO NOT EDIT)
// ======================================================
// Generated from: effortless-rulebook/effortless-rulebook.json
//
// This file contains structs and calculation functions
// for all tables defined in the rulebook.

package main

import (
	&quot;encoding/json&quot;
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;strconv&quot;
)

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

// boolVal safely dereferences a *bool, returning false if nil
func boolVal(b *bool) bool {
	if b == nil {
		return false
	}
	return *b
}

// stringVal safely dereferences a *string, returning &quot;&quot; if nil
func stringVal(s *string) string {
	if s == nil {
		return &quot;&quot;
	}
	return *s
}

// nilIfEmpty returns nil for empty strings, otherwise a pointer to the string
func nilIfEmpty(s string) *string {
	if s == &quot;&quot; {
		return nil
	}
	return &amp;s
}

// intToString safely converts a *int to string, returning &quot;&quot; if nil
func intToString(i *int) string {
	if i == nil {
		return &quot;&quot;
	}
	return strconv.Itoa(*i)
}

// boolToString converts a bool to &quot;true&quot; or &quot;false&quot;
func boolToString(b bool) string {
	if b {
		return &quot;true&quot;
	}
	return &quot;false&quot;
}

// =============================================================================
// CUSTOMERS TABLE
// =============================================================================

// Customer represents a row in the Customers table
type Customer struct {
	CustomerId string `json:&quot;customer_id&quot;`
	Customer *string `json:&quot;customer&quot;`
	EmailAddress *string `json:&quot;email_address&quot;`
	FirstName *string `json:&quot;first_name&quot;`
	LastName *string `json:&quot;last_name&quot;`
	FullName *string `json:&quot;full_name&quot;`
}

// --- Individual Calculation Functions ---

// CalcFullName computes the FullName calculated field
// Formula: ={{LastName}} &amp; &quot;, &quot; &amp; {{FirstName}}
func (tc *Customer) CalcFullName() string {
	return stringVal(tc.LastName) + &quot;, &quot; + stringVal(tc.FirstName)
}

// --- Compute All Calculated Fields ---

// ComputeAll computes all calculated fields and returns an updated struct
func (tc *Customer) ComputeAll() *Customer {
	// Level 1 calculations
	fullName := stringVal(tc.LastName) + &quot;, &quot; + stringVal(tc.FirstName)

	return &amp;Customer{
		CustomerId: tc.CustomerId,
		Customer: tc.Customer,
		EmailAddress: tc.EmailAddress,
		FirstName: tc.FirstName,
		LastName: tc.LastName,
		FullName: nilIfEmpty(fullName),
	}
}

// =============================================================================
// FILE I/O FUNCTIONS (for all tables with calculated fields)
// =============================================================================

// LoadCustomerRecords loads Customers records from a JSON file
func LoadCustomerRecords(path string) ([]Customer, error) {
	data, err := os.ReadFile(path)
	if err != nil {
		return nil, fmt.Errorf(&quot;failed to read file: %w&quot;, err)
	}

	var records []Customer
	if err := json.Unmarshal(data, &amp;records); err != nil {
		return nil, fmt.Errorf(&quot;failed to parse file: %w&quot;, err)
	}

	return records, nil
}

// SaveCustomerRecords saves computed Customers records to a JSON file
func SaveCustomerRecords(path string, records []Customer) error {
	data, err := json.MarshalIndent(records, &quot;&quot;, &quot;  &quot;)
	if err != nil {
		return fmt.Errorf(&quot;failed to marshal records: %w&quot;, err)
	}

	if err := os.WriteFile(path, data, 0644); err != nil {
		return fmt.Errorf(&quot;failed to write records: %w&quot;, err)
	}

	return nil
}
</pre>
            </div>
        </div>
        <div id="main" class="tab-content">
            <div class="card">
                <div class="code-header">
                    <h2>main.go</h2>
                    <div><span class="code-info">91 lines</span><button class="copy-btn" onclick="copyCode('main-code')">Copy</button></div>
                </div>
                <pre id="main-code">// ERB SDK - Go Test Runner (GENERATED - DO NOT EDIT)
// =======================================================
// This file is REGENERATED every time inject-into-golang.py runs.
// It must stay in sync with erb_sdk.go and the rulebook.
//
// Tables with calculated fields: Customers
//
// IMPORTANT: This runner processes ALL tables, not just a &quot;primary&quot; one.
// If ANY table fails to process, the entire run fails with exit code 1.

package main

import (
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;path/filepath&quot;
)

func main() {
	scriptDir, err := os.Getwd()
	if err != nil {
		fmt.Fprintf(os.Stderr, &quot;FATAL: Failed to get working directory: %v\n&quot;, err)
		os.Exit(1)
	}

	// Shared blank-tests directory at project root
	blankTestsDir := filepath.Join(scriptDir, &quot;..&quot;, &quot;..&quot;, &quot;testing&quot;, &quot;blank-tests&quot;)
	testAnswersDir := filepath.Join(scriptDir, &quot;test-answers&quot;)

	// Ensure output directory exists
	if err := os.MkdirAll(testAnswersDir, 0755); err != nil {
		fmt.Fprintf(os.Stderr, &quot;FATAL: Failed to create test-answers directory: %v\n&quot;, err)
		os.Exit(1)
	}

	fmt.Println(&quot;Golang substrate: Processing 1 tables with calculated fields...&quot;)
	fmt.Println(&quot;  Expected tables: Customers&quot;)
	fmt.Println(&quot;&quot;)

	// Track success/failure for ALL tables
	var errors []string
	var totalRecords int

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Process Customers
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	fmt.Println(&quot;Processing Customers...&quot;)
	customersInput := filepath.Join(blankTestsDir, &quot;customers.json&quot;)
	customersOutput := filepath.Join(testAnswersDir, &quot;customers.json&quot;)

	customersRecords, err := LoadCustomerRecords(customersInput)
	if err != nil {
		errMsg := fmt.Sprintf(&quot;Customers: failed to load - %v&quot;, err)
		fmt.Fprintf(os.Stderr, &quot;ERROR: %s\n&quot;, errMsg)
		errors = append(errors, errMsg)
	} else {
		var computedCustomer []Customer
		for _, r := range customersRecords {
			computedCustomer = append(computedCustomer, *r.ComputeAll())
		}

		if err := SaveCustomerRecords(customersOutput, computedCustomer); err != nil {
			errMsg := fmt.Sprintf(&quot;Customers: failed to save - %v&quot;, err)
			fmt.Fprintf(os.Stderr, &quot;ERROR: %s\n&quot;, errMsg)
			errors = append(errors, errMsg)
		} else {
			fmt.Printf(&quot;  âœ“ customers: %d records processed\n&quot;, len(computedCustomer))
			totalRecords += len(computedCustomer)
		}
	}
	fmt.Println(&quot;&quot;)

	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	// Final validation - FAIL LOUDLY if any errors occurred
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	if len(errors) &gt; 0 {
		fmt.Fprintf(os.Stderr, &quot;\n&quot;)
		fmt.Fprintf(os.Stderr, &quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n&quot;)
		fmt.Fprintf(os.Stderr, &quot;FATAL: %d table(s) FAILED to process\n&quot;, len(errors))
		fmt.Fprintf(os.Stderr, &quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n&quot;)
		for _, e := range errors {
			fmt.Fprintf(os.Stderr, &quot;  â€¢ %s\n&quot;, e)
		}
		fmt.Fprintf(os.Stderr, &quot;\n&quot;)
		os.Exit(1)
	}

	fmt.Println(&quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&quot;)
	fmt.Printf(&quot;Golang substrate: ALL %d tables processed successfully (%d total records)\n&quot;, 1, totalRecords)
	fmt.Println(&quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&quot;)
}</pre>
            </div>
        </div>
    </main>
    <script>
const themeToggle = document.getElementById('theme-toggle');
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
function getInitialTheme() { try { if (window.parent && window.parent.document.documentElement.dataset.theme) return window.parent.document.documentElement.dataset.theme; } catch (e) {} return prefersDark ? 'dark' : 'light'; }
document.documentElement.dataset.theme = getInitialTheme();
themeToggle.addEventListener('click', () => { document.documentElement.dataset.theme = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark'; });
window.addEventListener('message', (event) => { if (event.data.type === 'theme-change') document.documentElement.dataset.theme = event.data.theme; });
document.querySelectorAll('.tab').forEach(tab => { tab.addEventListener('click', () => { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); tab.classList.add('active'); document.getElementById(tab.dataset.tab).classList.add('active'); }); });
function copyCode(elementId) { navigator.clipboard.writeText(document.getElementById(elementId).textContent).then(() => { event.target.textContent = 'Copied!'; setTimeout(() => event.target.textContent = 'Copy', 2000); }); }
    </script>
</body>
</html>