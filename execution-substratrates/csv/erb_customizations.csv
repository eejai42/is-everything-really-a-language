erb_customization_id,name,title,sql_code,sql_target,customization_type
01b-customize-schema-sql,01b-customize-schema.sql,Customize Schema,"-- ============================================================================
-- CUSTOMIZE SCHEMA - User-defined tables and schema modifications
-- ============================================================================
-- This file is for YOUR custom schema changes that should persist across
-- regeneration of the base ERB files.
--
-- USE THIS FILE FOR:
--   - Additional tables not defined in the rulebook
--   - Extra columns on existing tables (ALTER TABLE)
--   - Custom indexes for performance tuning
--   - Custom constraints or triggers
--
-- IMPORTANT:
--   - This file runs AFTER 01-drop-and-create-tables.sql
--   - The base tables already exist when this runs
--   - This file will NOT be overwritten by ERB regeneration
--
-- ============================================================================

-- Your custom schema changes go here:
",Postgres,Schema
02b-customize-functions-sql,02b-customize-functions.sql,Customize Functions,"-- Prediction Fail: Returns TRUE when predicted_answer doesn't match is_language
DROP FUNCTION IF EXISTS calc_language_candidates_prediction_fail_x;

CREATE OR REPLACE FUNCTION calc_language_candidates_prediction_fail_x(p_language_candidate_id TEXT)
RETURNS TEXT AS $$
  SELECT NULLIF(
    COALESCE(
      CASE
        WHEN COALESCE(calc_language_candidates_predicted_answer(p_language_candidate_id), FALSE)
             != COALESCE(is_language, FALSE)
        THEN name || ' ' ||
             CASE WHEN calc_language_candidates_predicted_answer(p_language_candidate_id) THEN 'Is' ELSE 'Isn''t' END ||
             ' a Family Feud Language, but ' ||
             CASE WHEN is_language THEN 'Is' ELSE 'Is Not' END ||
             ' marked as a ''Language Candidate.'''
      END,
      ''
    ) ||
    COALESCE(
      CASE
        WHEN calc_language_candidates_is_open_closed_world_conflicted(p_language_candidate_id)
        THEN ' - Open World vs. Closed World Conflict.'
      END,
      ''
    ),
    ''
  )
  FROM language_candidates
  WHERE language_candidate_id = p_language_candidate_id;
$$ LANGUAGE SQL STABLE SECURITY DEFINER;

DROP FUNCTION calc_language_candidates_question;

CREATE OR REPLACE FUNCTION public.calc_language_candidates_question(p_language_candidate_id text)
 RETURNS text
 LANGUAGE plpgsql
 STABLE SECURITY DEFINER
AS $function$
BEGIN
  RETURN ('Is ' || (SELECT NULLIF(name, '''') FROM language_candidates WHERE language_candidate_id = p_language_candidate_id) || ' a language?')::text;
END;
$function$
",Postgres,Functions
03b-customize-views-sql,03b-customize-views.sql,Customize Views,"-- ============================================================================
-- CUSTOMIZE VIEWS - User-defined views and view extensions
-- ============================================================================
-- This file is for YOUR custom views that should persist across
-- regeneration of the base ERB files.
--
-- IMPORTANT:
--   - This file runs AFTER 03-create-views.sql
--   - All base vw_* views already exist when this runs
--   - This file will NOT be overwritten by ERB regeneration
--
-- ============================================================================

-- Your custom views go here:
",Postgres,Views
04b-customize-rls-sql,04b-customize-rls.sql,Customize Policies (RLS),"-- ============================================================================
-- CUSTOMIZE POLICIES - User-defined Row Level Security policies
-- ============================================================================
-- This file is for YOUR custom RLS policies that should persist across
-- regeneration of the base ERB files.
--
-- IMPORTANT:
--   - This file runs AFTER 04-create-policies.sql
--   - Base RLS policies already exist when this runs
--   - This file will NOT be overwritten by ERB regeneration
--
-- ============================================================================

-- Your custom policies go here:
",Postgres,RLS
05b-customize-data-sql,05b-customize-data.sql,Customize Data (Seeds / Migrations),"-- ============================================================================
-- CUSTOMIZE DATA - User-defined seed data and data migrations
-- ============================================================================
-- This file is for YOUR custom seed data that should persist across
-- regeneration of the base ERB files.
--
-- IMPORTANT:
--   - This file runs AFTER 05-insert-data.sql
--   - Base seed data already exists when this runs
--   - This file will NOT be overwritten by ERB regeneration
--
-- ============================================================================

-- Your custom data inserts go here:
",Postgres,Data
